<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2020-08-09">
<meta name="description" content="Awesome description">

<title>Psi ML - Circulant Matrices and the Discrete Fourier Transform</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Psi ML</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/spstolar"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/psistolar"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Circulant Matrices and the Discrete Fourier Transform</h1>
                  <div>
        <div class="description">
          Awesome description
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">fastpages</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 9, 2020</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#circulant-matrices-and-the-discrete-fourier-transform" id="toc-circulant-matrices-and-the-discrete-fourier-transform" class="nav-link active" data-scroll-target="#circulant-matrices-and-the-discrete-fourier-transform">Circulant Matrices and the Discrete Fourier Transform</a>
  <ul class="collapse">
  <li><a href="#discrete-fourier-transform" id="toc-discrete-fourier-transform" class="nav-link" data-scroll-target="#discrete-fourier-transform">Discrete Fourier Transform</a></li>
  <li><a href="#define-vectors" id="toc-define-vectors" class="nav-link" data-scroll-target="#define-vectors">Define Vectors</a></li>
  <li><a href="#circular-convolutions" id="toc-circular-convolutions" class="nav-link" data-scroll-target="#circular-convolutions">Circular Convolutions</a></li>
  <li><a href="#circular-convolution-is-multiplication-with-a-circulant-matrix" id="toc-circular-convolution-is-multiplication-with-a-circulant-matrix" class="nav-link" data-scroll-target="#circular-convolution-is-multiplication-with-a-circulant-matrix">Circular Convolution is Multiplication with a Circulant Matrix</a></li>
  <li><a href="#how-dft-is-related" id="toc-how-dft-is-related" class="nav-link" data-scroll-target="#how-dft-is-related">How DFT Is Related</a></li>
  <li><a href="#how-does-this-work" id="toc-how-does-this-work" class="nav-link" data-scroll-target="#how-does-this-work">How Does This Work</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="circulant-matrices-and-the-discrete-fourier-transform" class="level1">
<h1>Circulant Matrices and the Discrete Fourier Transform</h1>
<p>While reading <a href="https://towardsdatascience.com/deriving-convolution-from-first-principles-4ff124888028">this great post</a> I saved off the paper that it references: <a href="https://arxiv.org/abs/1805.05533">Discovering transforms: a tutorial on circulant matrices, circular convolution, and the discrete Fourier transform</a> by Bassam Bamieh. This last week, I dug into the paper and found it super readable and interesting. So this is just my digging into some of the details and making pictures to help things make sense for me.</p>
<section id="discrete-fourier-transform" class="level2">
<h2 class="anchored" data-anchor-id="discrete-fourier-transform">Discrete Fourier Transform</h2>
<p>The Discrete Fourier Transform (DFT) is a very useful operator that takes a tuple of complex numbers to another tuple of complex numbers. You typically see it defined as an operator on length-n complex vectors <span class="math inline">\(\mathrm{DFT}: \mathbb{C}^n \to \mathbb{C}^n\)</span> as a rule which sends <span class="math inline">\(a \mapsto \hat{a}\)</span>:</p>
<p><span class="math display">\[\hat{a}_k := \sum_{l = 0}^{n-1} a_l e^{-i\frac{2\pi}{n}kl}\]</span></p>
<p>The issue is that this kind of comes out of nowhere. You might see it in a course without knowing anything about complex analysis or linear algebra where the transform will be defined, perhaps used as an excuse to explain some of the basics of complex analysis, then some properties of the transform will be derived and you’ll use it as a tool for say, solving ODEs. There is a <a href="https://en.wikipedia.org/wiki/Discrete_Fourier_transform">lot of depth</a> to this transformation. Rather than discuss its interpretation and uses, I will give some of the high level details of the Bamieh paper which shows how to arrive at it from naturally exploring circular convolutions.</p>
</section>
<section id="define-vectors" class="level2">
<h2 class="anchored" data-anchor-id="define-vectors">Define Vectors</h2>
<p>For all the examples we will run, we make two simple vectors:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.arange(<span class="dv">5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span> ,<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">&gt;</span> array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>b <span class="op">&gt;</span> array([ <span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>,  <span class="dv">3</span>,  <span class="dv">2</span>,  <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="circular-convolutions" class="level2">
<h2 class="anchored" data-anchor-id="circular-convolutions">Circular Convolutions</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Convolution">convolution</a> of two functions <span class="math inline">\(f, g\)</span> is a way to produce a third function that has properties of the two components: <span class="math display">\[ f \star g (t) = \int_{-\infty}^\infty f(\tau) g(t - \tau) d \tau \]</span></p>
<p>Vector convolutions are similar, and we can think of it as a discrete version of the . When you use the <a href="https://numpy.org/doc/stable/reference/generated/numpy.convolve.html">built in functions from numpy for the convolution of two vectors</a> you are using this definition: <span class="math display">\[ a \star x [k] = \sum_{l = \infty}^{\infty} a[l] x[k - l] \]</span></p>
<p>The idea is that you are thinking of infinite-dimensional vectors indexed by the integers. So, when you plug in vectors like <code>[1, 2, 3]</code> you are interpreting them as <code>[..., 0, 0, 0, 1, 2, 3, 0, 0, 0, ...]</code>.</p>
<p>The default mode of <code>np.convolve</code> is ‘full’, but there are also ‘same’ and ‘valid’ modes. Full executes the convolution, but clips the output one index after the results are all zeros:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>np.convolve(a, b, <span class="st">'full'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="dv">0</span>,  <span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">7</span>, <span class="dv">13</span>,  <span class="dv">9</span>, <span class="dv">18</span>,  <span class="dv">8</span>,  <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>np.convolve([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], <span class="st">'full'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Same returns an output that has the same size as the bigger input:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>np.convolve(a, b, <span class="st">'same'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="dv">3</span>,  <span class="dv">7</span>, <span class="dv">13</span>,  <span class="dv">9</span>, <span class="dv">18</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>np.convolve([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], <span class="st">'same'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Valid only returns the output where the signals fully overlapped:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>np.convolve(a, b, <span class="st">'valid'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>np.convolve([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], <span class="st">'valid'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.convolve.html"><code>scipy</code> implementation</a> is similar</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> signal</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>signal.convolve(a, b)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="dv">0</span>,  <span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">7</span>, <span class="dv">13</span>,  <span class="dv">9</span>, <span class="dv">18</span>,  <span class="dv">8</span>,  <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, we are interested in the <strong>circular</strong> convolution, where we treat the domain as periodic. Rather than summing over all of the integers, we are thinking of doing arithmetic modulo n.&nbsp;Thus it is useful to view vectors are being circularly arranged:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/circle_vector.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">test2</figcaption><p></p>
</figure>
</div>
<p>Then the circular convolution of two vectors is defined: <span class="math display">\[ a \star x [k] = \sum_{l = 0}^{n-1} a_{k -l} x_l\]</span> this is described in more detail in the paper.</p>
<p>To visualize this first we use a drawing to indicate the inner product of two vectors by stacking the circular representation of one on top of the other:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/comp_mult.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">component-wise multiplication</figcaption><p></p>
</figure>
</div>
<p>We multiply components by matching the top circular vector to the bottom one. Using this, we get the circular convolution of two vectors by</p>
<ol type="1">
<li>reversing the first argument vector so that it goes from 0 to <span class="math inline">\(n-1\)</span> clockwise rather than counter-clockwise and</li>
<li>performing a bunch of inner products with each rotation of the “convolving vector” that we flipped (here we use <span class="math inline">\(a\)</span>) with the second-argument vector (here we use <span class="math inline">\(x\)</span> or <span class="math inline">\(b\)</span> in the examples).</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/circular_convolution.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">circular convolution</figcaption><p></p>
</figure>
</div>
<p>Thus coordinate <code>k</code> of the circular convolution <span class="math inline">\(a \star x\)</span> is the inner product of x with <span class="math inline">\(a\)</span> reversed and then rotated <span class="math inline">\(k\)</span> times.</p>
<p>We implement this in a straightforward fashion, ignoring the fact that it isn’t optimized:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> circular_convolution(a, x):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(a)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.zeros(n)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> l <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            y[k] <span class="op">+=</span> a[k<span class="op">-</span>l] <span class="op">*</span> x[l]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For example, we get a new length-5 vector by convolving <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>circular_convolution(a, b)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">9.</span>, <span class="fl">20.</span>, <span class="fl">11.</span>,  <span class="fl">7.</span>, <span class="fl">13.</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="circular-convolution-is-multiplication-with-a-circulant-matrix" class="level2">
<h2 class="anchored" data-anchor-id="circular-convolution-is-multiplication-with-a-circulant-matrix">Circular Convolution is Multiplication with a Circulant Matrix</h2>
<p>The circulant matrix of a vector is built like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/circulant_shift.svg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">create circulant</figcaption><p></p>
</figure>
</div>
<p>There is a <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.circulant.html"><code>scipy</code> method</a> for constructing them:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> circulant</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>C_a <span class="op">=</span> circulant(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>C_b <span class="op">=</span> circulant(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>C_a</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([[<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">3</span>],</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">4</span>],</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>C_b</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([[ <span class="dv">2</span>,  <span class="dv">0</span>,  <span class="dv">2</span>,  <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           [<span class="op">-</span><span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">0</span>,  <span class="dv">2</span>,  <span class="dv">3</span>],</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>           [ <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">0</span>,  <span class="dv">2</span>],</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="dv">2</span>,  <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">0</span>],</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>           [ <span class="dv">0</span>,  <span class="dv">2</span>,  <span class="dv">3</span>, <span class="op">-</span><span class="dv">1</span>,  <span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To see how you can make a circulant matrix (again not optimized):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> right_shift(v):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(v)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    shifted_v <span class="op">=</span> np.zeros(n)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        shifted_v[i] <span class="op">=</span> v[i<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> shifted_v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>right_shift(a)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="fl">4.</span>, <span class="fl">0.</span>, <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_circulant(v):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(v)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    C_v <span class="op">=</span> np.zeros((n, n))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    C_v[:, <span class="dv">0</span>] <span class="op">=</span> v  <span class="co"># first column is just the vector</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># next columns are each right/down-shifted</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, n):</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        C_v[:, i] <span class="op">=</span> right_shift(C_v[:, i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> C_v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>custom_circulant(a)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[<span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>],</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>],</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>],</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>],</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>An interesting fact is that circulant matrices commute:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>C_a <span class="op">@</span> C_b <span class="op">==</span> C_b <span class="op">@</span> C_a</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>C_a <span class="op">@</span> C_b</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[ <span class="dv">9</span>, <span class="dv">13</span>,  <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">20</span>],</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">20</span>,  <span class="dv">9</span>, <span class="dv">13</span>,  <span class="dv">7</span>, <span class="dv">11</span>],</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">11</span>, <span class="dv">20</span>,  <span class="dv">9</span>, <span class="dv">13</span>,  <span class="dv">7</span>],</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">20</span>,  <span class="dv">9</span>, <span class="dv">13</span>],</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">13</span>,  <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">20</span>,  <span class="dv">9</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But now look, if <span class="math inline">\(C_a\)</span> is the circulant matrix built from <span class="math inline">\(a\)</span>, <span class="math display">\[a \star x = C_a x\]</span></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>C_a <span class="op">@</span> b <span class="op">==</span> circular_convolution(a, b)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Circular convolution is just multiplying by the circulant matrix and moreover (see the paper) <span class="math display">\[ a \star x = C_a x = C_x a = a \star x\]</span></p>
</section>
<section id="how-dft-is-related" class="level2">
<h2 class="anchored" data-anchor-id="how-dft-is-related">How DFT Is Related</h2>
<p>Now let’s use the numpy implementation of the discrete fourier transform:</p>
<p><span class="math inline">\(\hat{a} = \mathrm{DFT}(a)\)</span></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>a_hat <span class="op">=</span> np.fft.fft(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><span class="math inline">\(\hat{b} = \mathrm{DFT}(b)\)</span></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>b_hat <span class="op">=</span> np.fft.fft(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>a_hat</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="fl">10.</span> <span class="op">+</span><span class="ot">0.j</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">3.4409548j</span> , <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">0.81229924j</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">0.81229924j</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">3.4409548j</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>b_hat</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">6.</span><span class="op">+</span><span class="ot">0.j</span>, <span class="op">-</span><span class="fl">2.35410197</span><span class="op">+</span><span class="ot">0.36327126j</span>, <span class="fl">4.35410197</span><span class="op">+</span><span class="ot">1.53884177j</span>,  <span class="fl">4.35410197</span><span class="op">-</span><span class="ot">1.53884177j</span>, <span class="op">-</span><span class="fl">2.35410197</span><span class="op">-</span><span class="ot">0.36327126j</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now take the component-wise product of these DFT’d vectors <span class="math inline">\(\hat{a}\)</span> and <span class="math inline">\(\hat{b}\)</span>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>hat_prod <span class="op">=</span> a_hat <span class="op">*</span> b_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>hat_prod</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">60.</span><span class="op">+</span><span class="ot">0.j</span>, <span class="fl">4.63525492</span><span class="op">-</span><span class="ot">9.00853662j</span>, <span class="op">-</span><span class="fl">12.13525492</span><span class="op">-</span><span class="ot">0.3102707j</span> , <span class="op">-</span><span class="fl">12.13525492</span><span class="op">+</span><span class="ot">0.3102707j</span> , <span class="fl">4.63525492</span><span class="op">+</span><span class="ot">9.00853662j</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now let’s undo the DFT using the Inverse Discrete Fourier Transform:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>np.fft.ifft(hat_prod)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">9.</span><span class="op">+</span><span class="ot">0.j</span>, <span class="fl">20.</span><span class="op">+</span><span class="ot">0.j</span>, <span class="fl">11.</span><span class="op">+</span><span class="ot">0.j</span>,  <span class="fl">7.</span><span class="op">+</span><span class="ot">0.j</span>, <span class="fl">13.</span><span class="op">+</span><span class="ot">0.j</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So, <span class="math inline">\(\mathrm{DFT}^{-1}(\hat{a} * \hat{b})\)</span> was <code>[9, 20, 11, 7, 13]</code> in our example, all real with no imaginary components.</p>
<p>But wait a second:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>circular_convolution(a, b)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">9.</span>, <span class="fl">20.</span>, <span class="fl">11.</span>,  <span class="fl">7.</span>, <span class="fl">13.</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Cool! <span class="math display">\[\mathrm{DFT}^{-1}(\hat{a} * \hat{b}) = a \star b\]</span></p>
</section>
<section id="how-does-this-work" class="level2">
<h2 class="anchored" data-anchor-id="how-does-this-work">How Does This Work</h2>
<p>Hopefully this notebook will interest you enough to dive into the source paper to find out why this “trick” works, but here are some of the details with examples.</p>
<p>First iteresting fact: the DFT of a vector gives the same result as the eigenvalues of the circulant matrix for that vector.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>np.fft.fft(a)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="fl">10.</span> <span class="op">+</span><span class="ot">0.j</span>        , <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">3.4409548j</span> , <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">0.81229924j</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">0.81229924j</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">3.4409548j</span> ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>np.linalg.eigvals(C_a)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="fl">10.</span> <span class="op">+</span><span class="ot">0.j</span>        , <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">3.4409548j</span> , <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">3.4409548j</span> ,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">2.5</span><span class="op">+</span><span class="ot">0.81229924j</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">-</span><span class="ot">0.81229924j</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>custom_circulant(a)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[<span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>],</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>],</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>],</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>, <span class="fl">4.</span>],</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>, <span class="fl">0.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Second interesting fact: the circulant matrices commute with the operator that rotates a circular vector. This is because this operator, the step matrix <span class="math inline">\(S\)</span>, is itself a circulant matrix.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>step_matrix <span class="op">=</span> circulant([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>step_matrix</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So it makes us step right/clockwise:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>step_matrix <span class="op">@</span> a</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The adjoint of the step matrix <span class="math inline">\(S^*\)</span> is just the step in the other direction.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>step_matrix_adjoint <span class="op">=</span> step_matrix.T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>step_matrix_adjoint</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>           [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>step_matrix_adjoint <span class="op">@</span> a</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Interesting fact 3: the step matrix is a fundamental example of a circulant matrix. If you look at the eigenvalues and eigenvectors of its adjoint, you recover the DFT as well as connection between the periodic domain and modular arithmetic used in the definition of the circular convolution.</p>
<p>The eigenvalues of <span class="math inline">\(S^*\)</span>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>step_eigs <span class="op">=</span> np.linalg.eigvals(step_matrix_adjoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>step_eigs</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="op">-</span><span class="fl">0.80901699</span><span class="op">+</span><span class="ot">0.58778525j</span>, <span class="op">-</span><span class="fl">0.80901699</span><span class="op">-</span><span class="ot">0.58778525j</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.30901699</span><span class="op">+</span><span class="ot">0.95105652j</span>,  <span class="fl">0.30901699</span><span class="op">-</span><span class="ot">0.95105652j</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>            <span class="fl">1.</span>        <span class="op">+</span><span class="ot">0.j</span>        ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It may be hard to see a pattern here, so let’s plot them on the complex plane.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Circle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>circle <span class="op">=</span> Circle((<span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">1</span>, facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                edgecolor<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>), linewidth<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>ax.add_patch(circle)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.real(step_eigs), np.imag(step_eigs), alpha<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/output_91_1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">png</figcaption><p></p>
</figure>
</div>
<p>These are the roots of unity. In this case, because we were looking at <span class="math inline">\(n = 5\)</span>, they are the fifth-roots of unity: <span class="math inline">\(\exp \left(\frac{i 2 \pi k}{5} \right)\)</span> for <span class="math inline">\(k = 0, 1, 2, 3, 4\)</span>.</p>
<p>You can build a matrix with nice choices of eigenvectors of <span class="math inline">\(S^*\)</span>:</p>
<p><span class="math display">\[ \begin{pmatrix}
1 &amp; 1 &amp; 1 &amp; \dots &amp; 1 \\
1 &amp; \rho &amp; \rho^2 &amp; \dots &amp; \rho^{n-1} \\
1 &amp; \rho^{2} &amp; \rho^4 &amp; \dots &amp; \rho^{2(n-1)} \\
\vdots &amp; \vdots &amp; \vdots &amp; &amp; \vdots \\
1 &amp; \rho^{n-1} &amp; \rho^{2(n-1)} &amp; \dots &amp; \rho^{(n-1)(n-1)}
\end{pmatrix} \]</span></p>
<p>where <span class="math inline">\(\rho\)</span> is the first root of unity. For example <span class="math inline">\(\exp \left(\frac{i 2 \pi}{5} \right)\)</span> for <span class="math inline">\(n = 5\)</span>, the top root in that picture.</p>
<p>First we make a way to grab the <span class="math inline">\(n\)</span>-th roots:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roots_of_unity(n):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># returns solutions to: x^n - 1 = 0</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> np.zeros(n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    coeffs[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>  <span class="co"># x^n</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    coeffs[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>  <span class="co"># - 1</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.roots(coeffs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s verify this by checking the <span class="math inline">\(n\)</span>-th power of each of the roots:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>[r<span class="op">**</span><span class="dv">2</span> <span class="cf">for</span> r <span class="kw">in</span> roots_of_unity(<span class="dv">2</span>)]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> [<span class="fl">1.0</span>, <span class="fl">1.0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>[r<span class="op">**</span><span class="dv">3</span> <span class="cf">for</span> r <span class="kw">in</span> roots_of_unity(<span class="dv">3</span>)]</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> [(<span class="fl">1.0000000000000007</span><span class="op">-</span><span class="ot">3.885780586188048e-16j</span>),</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>     (<span class="fl">1.0000000000000007</span><span class="op">+</span><span class="ot">3.885780586188048e-16j</span>),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>     (<span class="fl">0.9999999999999993</span><span class="op">+</span><span class="ot">0j</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For our example we want:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fifth_roots <span class="op">=</span> roots_of_unity(<span class="dv">5</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>fifth_roots</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="op">-</span><span class="fl">0.80901699</span><span class="op">+</span><span class="ot">0.58778525j</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span><span class="fl">0.80901699</span><span class="op">-</span><span class="ot">0.58778525j</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.30901699</span><span class="op">+</span><span class="ot">0.95105652j</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.30901699</span><span class="op">-</span><span class="ot">0.95105652j</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>          <span class="fl">1.</span>        <span class="op">+</span><span class="ot">0.j</span>        ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It can be helpful to view the real and complex parts separately especially when there are more than 3 significant digits. You can also set the precision displayed:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>np.set_printoptions(precision<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>np.real(fifth_roots)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([<span class="op">-</span><span class="fl">0.81</span>, <span class="op">-</span><span class="fl">0.81</span>,  <span class="fl">0.31</span>,  <span class="fl">0.31</span>,  <span class="fl">1.</span>  ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>np.imag(fifth_roots)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([ <span class="fl">0.59</span>, <span class="op">-</span><span class="fl">0.59</span>,  <span class="fl">0.95</span>, <span class="op">-</span><span class="fl">0.95</span>,  <span class="fl">0.</span>  ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now let’s plot them to make sure they look right:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="fl">1.1</span>, <span class="fl">1.1</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>circle <span class="op">=</span> Circle((<span class="dv">0</span>, <span class="dv">0</span>), <span class="dv">1</span>, facecolor<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>                edgecolor<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>), linewidth<span class="op">=</span><span class="dv">3</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>ax.add_patch(circle)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>ax.scatter(np.real(fifth_roots), np.imag(fifth_roots), alpha<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../../images/output_109_1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">png</figcaption><p></p>
</figure>
</div>
<p>So, the way it supplied roots was sort of “out of order”. We the one on the top which was at index 2:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>first_root <span class="op">=</span> fifth_roots[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>first_root</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> (<span class="fl">0.30901699437494734</span><span class="op">+</span><span class="ot">0.9510565162951536j</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>first_root <span class="op">**</span> <span class="dv">5</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> (<span class="dv">1</span><span class="op">+</span><span class="ot">4.440892098500626e-16j</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When checking equality of floats you can run into precision issues, so it’s nice to use <code>np.isclose()</code>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>np.isclose(first_root <span class="op">**</span> <span class="dv">5</span>, <span class="dv">1</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So it is indeed a fifth root.</p>
<p>We want to show a relationship between the matrix of eigenvectors for the step matrix and DFT, but the default eigenvectors are not in quite the shape we want:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>W <span class="op">=</span> np.linalg.eig(step_matrix_adjoint)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>W</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[ <span class="fl">0.14</span><span class="op">-</span><span class="ot">0.43j</span>,  <span class="fl">0.14</span><span class="op">+</span><span class="ot">0.43j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">-</span><span class="ot">0.26j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">+</span><span class="ot">0.26j</span>,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ],</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">0.14</span><span class="op">+</span><span class="ot">0.43j</span>,  <span class="fl">0.14</span><span class="op">-</span><span class="ot">0.43j</span>,  <span class="fl">0.14</span><span class="op">-</span><span class="ot">0.43j</span>,  <span class="fl">0.14</span><span class="op">+</span><span class="ot">0.43j</span>,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ],</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>           [<span class="op">-</span><span class="fl">0.36</span><span class="op">-</span><span class="ot">0.26j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">+</span><span class="ot">0.26j</span>,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">0.45</span><span class="op">-</span><span class="ot">0.j</span>  ,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ],</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">0.45</span><span class="op">-</span><span class="ot">0.j</span>  ,  <span class="fl">0.14</span><span class="op">+</span><span class="ot">0.43j</span>,  <span class="fl">0.14</span><span class="op">-</span><span class="ot">0.43j</span>,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ],</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>           [<span class="op">-</span><span class="fl">0.36</span><span class="op">+</span><span class="ot">0.26j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">-</span><span class="ot">0.26j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">+</span><span class="ot">0.26j</span>, <span class="op">-</span><span class="fl">0.36</span><span class="op">-</span><span class="ot">0.26j</span>,  <span class="fl">0.45</span><span class="op">+</span><span class="ot">0.j</span>  ]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Which is why we need to do this work to get our desired form</p>
<p><span class="math display">\[ \begin{pmatrix}
1 &amp; 1 &amp; 1 &amp; \dots &amp; 1 \\
1 &amp; \rho &amp; \rho^2 &amp; \dots &amp; \rho^{n-1} \\
1 &amp; \rho^{2} &amp; \rho^4 &amp; \dots &amp; \rho^{2(n-1)} \\
\vdots &amp; \vdots &amp; \vdots &amp; &amp; \vdots \\
1 &amp; \rho^{n-1} &amp; \rho^{2(n-1)} &amp; \dots &amp; \rho^{(n-1)(n-1)}
\end{pmatrix} \]</span></p>
<p>So the powers (mod n) are:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>root_power <span class="op">=</span> np.zeros((n, n))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        power <span class="op">=</span> j <span class="op">*</span> i <span class="op">%</span> n</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        root_power[i, j] <span class="op">=</span> power</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>root_power</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[<span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>],</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>, <span class="fl">4.</span>],</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">2.</span>, <span class="fl">4.</span>, <span class="fl">1.</span>, <span class="fl">3.</span>],</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">3.</span>, <span class="fl">1.</span>, <span class="fl">4.</span>, <span class="fl">2.</span>],</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">4.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For 5 this is a bit boring because it’s prime, but for 4:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>root_power <span class="op">=</span> np.zeros((n, n))</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        power <span class="op">=</span> j <span class="op">*</span> i <span class="op">%</span> n</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        root_power[i, j] <span class="op">=</span> power</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>root_power</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([[<span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>, <span class="fl">0.</span>],</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">1.</span>, <span class="fl">2.</span>, <span class="fl">3.</span>],</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">2.</span>, <span class="fl">0.</span>, <span class="fl">2.</span>],</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>           [<span class="fl">0.</span>, <span class="fl">3.</span>, <span class="fl">2.</span>, <span class="fl">1.</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we use the first root of unity and raise it to the desired powers to create the matrix of eigenvectors in the nice form:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># might have to do this to get around an error where things are squashed to real parts</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>W <span class="op">=</span> np.zeros((step_matrix_adjoint.shape), dtype <span class="op">=</span> <span class="st">"complex_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>        power <span class="op">=</span> i <span class="op">*</span> j <span class="op">%</span> n</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>        W[i, j] <span class="op">=</span> first_root <span class="op">**</span> power</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>W</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> array([[ <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ],</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">0.31</span><span class="op">+</span><span class="ot">0.95j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">+</span><span class="ot">0.59j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">-</span><span class="ot">0.59j</span>,  <span class="fl">0.31</span><span class="op">-</span><span class="ot">0.95j</span>],</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  , <span class="op">-</span><span class="fl">0.81</span><span class="op">+</span><span class="ot">0.59j</span>,  <span class="fl">0.31</span><span class="op">-</span><span class="ot">0.95j</span>,  <span class="fl">0.31</span><span class="op">+</span><span class="ot">0.95j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">-</span><span class="ot">0.59j</span>],</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  , <span class="op">-</span><span class="fl">0.81</span><span class="op">-</span><span class="ot">0.59j</span>,  <span class="fl">0.31</span><span class="op">+</span><span class="ot">0.95j</span>,  <span class="fl">0.31</span><span class="op">-</span><span class="ot">0.95j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">+</span><span class="ot">0.59j</span>],</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>           [ <span class="fl">1.</span>  <span class="op">+</span><span class="ot">0.j</span>  ,  <span class="fl">0.31</span><span class="op">-</span><span class="ot">0.95j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">-</span><span class="ot">0.59j</span>, <span class="op">-</span><span class="fl">0.81</span><span class="op">+</span><span class="ot">0.59j</span>,  <span class="fl">0.31</span><span class="op">+</span><span class="ot">0.95j</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remembering the first root, we see this looks right.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>first_root</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> (<span class="fl">0.30901699437494734</span><span class="op">+</span><span class="ot">0.9510565162951536j</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can compute the adjoint (transpose and complex conjugate) with:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>W_adjoint <span class="op">=</span> W.T.conj()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The next interesting fact to think about is (5.1): <span class="math display">\[ C_a W = W \mathrm{diag}(\hat{a}) \]</span></p>
<p>Create the a diagonal matrix with the entries of <span class="math inline">\(\hat{a}\)</span></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>diag_a_hat <span class="op">=</span> np.diag(a_hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>np.isclose(C_a <span class="op">@</span> W, W <span class="op">@</span> diag_a_hat)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span>   array([[ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>],</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>           [ <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>,  <span class="va">True</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>What this is saying is that <span class="math inline">\(W\)</span> also provided eigenvectors for <span class="math inline">\(C_a\)</span> and they have eigenvalues from <span class="math inline">\(\mathrm{DFT}(a) = \hat{a}\)</span>. This nice matrix not only diagonalizes <span class="math inline">\(S^*\)</span> but it also diagonalizes <em>all circulant matrices simultaneously</em>.</p>
<p>This means we can compute DFTs of length <span class="math inline">\(n\)</span> just by knowing the n-th root of unity! (5.2) re-written: <span class="math display">\[\mathrm{Diag}(\hat{a}) = W^{-1} C_a W = \frac 1n W^* C_a W\]</span></p>
<p>But the point of (5.2) is circular convolution of x with a is just:</p>
<ol type="1">
<li><p>Take the DFT of x, using multiplication with the adjoint of a nice matrix of eigenvectors of the simple left-shift matrix (<span class="math inline">\(S^*\)</span>):</p>
<p><span class="math inline">\(W^* x\)</span></p></li>
<li><p>Entry-wise multiplication with this result by the DFT of <span class="math inline">\(a\)</span> (<span class="math inline">\(\hat{a}\)</span>):</p>
<p><span class="math inline">\(\mathrm{Diag}(\hat{a}) W^* x\)</span></p></li>
<li><p>Multiply this result by the inverse of the nice adjoint:</p>
<p><span class="math inline">\(\frac 1n W \mathrm{Diag}(\hat{a}) W^* x\)</span></p></li>
</ol>
<p>This is cool because not only do we see that DFT naturally comes from looking at shift-invariant transformations but we also have a way of understanding circular convolutions:</p>
<ul>
<li><span class="math inline">\(a \star x = x \star a = C_a x = C_x a = \mathrm{DFT}^{-1} ( \hat{x} \circ \hat{a})\)</span></li>
</ul>
<p>This last one is especially interesting, convolution is the time-domain equivalent of simple component-wise multiplication in the frequency domain.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>